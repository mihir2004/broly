datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id                 Int                  @id @default(autoincrement())
  whatsappNumber     String               @unique
  profileName        String?

  // How many reminders they have created
  reminderCount      Int                  @default(0)

  reminders          Reminder[]
  recurringReminders RecurringReminder[]
  weatherSubscription WeatherSubscription?
}

model Reminder {
  id        Int      @id @default(autoinincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])

  time      DateTime
  message   String
  createdAt DateTime @default(now())
}

enum RecurrenceType {
  DAILY
  MONTHLY
}

model RecurringReminder {
  id             Int            @id @default(autoincrement())
  userId         Int
  user           User           @relation(fields: [userId], references: [id])

  message        String
  recurrenceType RecurrenceType

  // For MONTHLY, which day of month (1â€“31)
  dayOfMonth     Int?

  // "HH:mm" 24-hour format
  timeOfDay      String

  active         Boolean        @default(true)

  lastTriggeredAt DateTime?

  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
}

model WeatherSubscription {
  id         Int      @id @default(autoincrement())
  userId     Int      @unique
  user       User     @relation(fields: [userId], references: [id])

  city       String
  active     Boolean  @default(true)
  lastSentAt DateTime?
  createdAt  DateTime @default(now())
}
